{"title": "Git 分支操作介绍", "url": "http://blog.jobbole.com/114107/", "create_time": "2018/06/10", "vote_nums": 1, "mark_nums": 1, "comment_nums": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/5/git-branching\">Kedar Vijay Kulkarni</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9724-1.html\">Linux中国/Andy Song</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/b84f8d56e47a8496314a55a39b08ad10.jpg\"></p>\n<p>在本系列的前两篇文章中，我们<a href=\"http://blog.jobbole.com/114101/\">开始使用 Git</a>，学会如何<a href=\"http://blog.jobbole.com/114104/\">克隆项目，修改、增加和删除内容</a>。在这第三篇文章中，我将介绍 Git 分支，为何以及如何使用分支。</p>\n<p><img class=\"aligncenter\" title=\"tree branches\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/33aa33f3f7c1b6dab4b586b93923469a.jpg\" alt=\"树枝\"></p>\n<p>不妨用树来描绘 Git 仓库。图中的树有很多分支，或长或短，或从树干延伸或从其它分支延伸。在这里，我们用树干比作仓库的 master 分支，其中 <code>master</code> 代指 ”master 分支”，是 Git 仓库的中心分支或第一个分支。为简单起见，我们假设 <code>master</code> 是树干，其它分支都是从该分支分出的。</p>\n<h3 id=\"toc_1\">为何在 Git 仓库中使用分支</h3>\n<p>使用分支的主要理由为：</p>\n<ul>\n<li>如果你希望为项目增加新特性，但很可能会影响当前可正常工作的代码。对于该项目的活跃用户而言，这是很糟糕的事情。与其将特性加入到其它人正在使用的 <code>master</code> 分支，更好的方法是在仓库的其它分支中变更代码，下面会给出具体的工作方式。</li>\n<li>更重要的是，<a href=\"https://en.wikipedia.org/wiki/Git\">Git 其设计</a>用于协作。如果所有人都在你代码仓库的 <code>master</code> 分支上操作，会引发很多混乱。对编程语言或项目的知识和阅历因人而异；有些人可能会编写有错误或缺陷的代码，也可能会编写你觉得不适合该项目的代码。使用分支可以让你核验他人的贡献并选择适合的加入到项目中。（这里假设你是代码库唯一的所有者，希望对增加到项目中的代码有完全的控制。在真实的项目中，代码库有多个具有合并代码权限的所有者）</li>\n</ul>\n<h3 id=\"toc_2\">创建分支</h3>\n<p>让我们回顾<a href=\"http://blog.jobbole.com/114104/\">本系列上一篇文章</a>，看一下在我们的 Demo 目录中分支是怎样的。如果你没有完成上述操作，请按照文章中的指示从 GitHub 克隆代码并进入 Demo 目录。运行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e649336861124856243\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npwd\r\ngit branch\r\nls -la\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e649336861124856243-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e649336861124856243-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e649336861124856243-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e649336861124856243-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e649336861124856243-1\"><span class=\"crayon-e\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e649336861124856243-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">branch</span></div><div class=\"crayon-line\" id=\"crayon-5b1e649336861124856243-3\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">la</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e649336861124856243-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><code>pwd</code> 命令（是当前工作目录的英文缩写）返回当前你所处的目录（以便确认你在 <code>Demo</code> 目录中），<code>git branch</code> 列出该项目在你主机上的全部分支，<code>ls -la</code> 列出当前目录下的所有文件。你的终端输出类似于：</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/50e63bfafb866781b469c1a77a4f93a7.png\" alt=\"终端输出\"></p>\n<p>在 <code>master</code> 分支中，只有一个文件 <code>README.md</code>。（Git 会友好地忽略掉其它目录和文件。）</p>\n<p>接下来，运行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e64933686e759915793\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit status\r\ngit checkout -b myBranch\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e64933686e759915793-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933686e759915793-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e64933686e759915793-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933686e759915793-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e64933686e759915793-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933686e759915793-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">checkout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">myBranch</span></div><div class=\"crayon-line\" id=\"crayon-5b1e64933686e759915793-3\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933686e759915793-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>第一条命令 <code>git status</code> 告知你当前位于 <code>branch master</code>，（就像在终端中看到的那样）它与 <code>origin/master</code> 处于同步状态，这意味着 master 分支的本地副本中的全部文件也出现在 GitHub 中。两份副本没有差异，所有的提交也是一致的。</p>\n<p>下一条命令 <code>git checkout -b myBranch</code> 中的 <code>-b</code> 告知 Git 创建一个名为 <code>myBranch</code> 的新分支，然后 <code>checkout</code> 命令将我们切换到新创建的分支。运行第三条命令 <code>git status</code> 确保你已经位于刚创建的分支下。</p>\n<p>如你所见，<code>git status</code> 告知你当前处于 <code>myBranch</code> 分支，没有变更需要提交。这是因为我们既没有增加新文件，也没有修改已有文件。</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/bf0f4c89a9667eb09fb29956b9cc9d56.png\" alt=\"终端输出\"></p>\n<p>如果希望以可视化的方式查看分支，可以运行 <code>gitk</code> 命令。如果遇到报错 <code>bash: gitk: command not found...</code>，请先安装 <code>gitk</code> 软件包（找到你操作系统对应的安装文档，以获得安装方式）。</p>\n<p>（LCTT 译注：需要在有 X 服务器的终端运行 <code>gitk</code>，否则会报错）</p>\n<p>下图展示了我们在 Demo 项目中的所作所为：你最后一次提交（的对应信息）是 <code>Delete file.txt</code>，在此之前有三次提交。当前的提交用黄点标注，之前的提交用蓝点标注，黄点和 <code>Delete file.txt</code> 之间的三个方块展示每个分支所在的位置（或者说每个分支中的最后一次提交的位置）。由于 <code>myBranch</code> 刚创建，提交状态与 <code>master</code> 分支及其对应的记为 <code>remotes/origin/master</code> 的远程 <code>master</code> 分支保持一致。（非常感谢来自 Red Hat 的 <a href=\"https://opensource.com/users/psav\">Peter Savage</a> 让我知道 <code>gitk</code> 这个工具）</p>\n<p><img class=\"aligncenter\" title=\"Gitk output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/4d766fc6104150cd915e1348c4ca080c.png\" alt=\"Gitk 输出\"></p>\n<p>下面让我们在 <code>myBranch</code> 分支下创建一个新文件并观察终端输出。运行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e649336874082101142\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\necho \"Creating a newFile on myBranch\" &gt; newFile\r\ncat newFile\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e649336874082101142-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e649336874082101142-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e649336874082101142-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e649336874082101142-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e649336874082101142-1\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Creating a newFile on myBranch\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">newFile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e649336874082101142-2\"><span class=\"crayon-e\">cat </span><span class=\"crayon-e\">newFile</span></div><div class=\"crayon-line\" id=\"crayon-5b1e649336874082101142-3\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e649336874082101142-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>第一条命令中的 <code>echo</code> 创建了名为 <code>newFile</code> 的文件，接着 <code>cat newFile</code> 打印出文件内容，最后 <code>git status</code> 告知你我们 <code>myBranch</code> 分支的当前状态。在下面的终端输出中，Git 告知 <code>myBranch</code> 分支下有一个名为 <code>newFile</code> 的文件当前处于 <code>untracked</code> 状态。这表明我们没有让 Git 追踪发生在文件 <code>newFile</code> 上的变更。</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/9940ad61d955b4a2cfbeb264b8844f73.png\" alt=\"终端输出\"></p>\n<p>下一步是增加文件，提交变更并将 <code>newFile</code> 文件推送至 <code>myBranch</code> 分支（请回顾本系列上一篇文章获得更多细节）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e64933687a355237164\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit add newFile\r\ngit commit -m \"Adding newFile to myBranch\"\r\ngit push origin myBranch\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e64933687a355237164-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933687a355237164-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e64933687a355237164-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933687a355237164-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e64933687a355237164-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">newFile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933687a355237164-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Adding newFile to myBranch\"</span></div><div class=\"crayon-line\" id=\"crayon-5b1e64933687a355237164-3\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">push </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">myBranch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933687a355237164-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在上述命令中，<code>push</code> 命令使用的分支参数为 <code>myBranch</code> 而不是 <code>master</code>。Git 添加 <code>newFile</code> 并将变更推送到你 GitHub 账号下的 Demo 仓库中，告知你在 GitHub 上创建了一个与你本地副本分支 <code>myBranch</code> 一样的新分支。终端输出截图给出了运行命令的细节及命令输出。</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/4f3bcd2a38a341027ce084f1ed51bfa4.png\" alt=\"终端输出\"></p>\n<p>当你访问 GitHub 时，在分支选择的下拉列表中可以发现两个可供选择的分支。</p>\n<p><img class=\"aligncenter\" title=\"GitHub\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/29592bacfeab5a8a161ca2f1b837c350.png\" alt=\"GitHub\"></p>\n<p>点击 <code>myBranch</code> 切换到 <code>myBranch</code> 分支，你可以看到在此分支上新增的文件。</p>\n<p><img class=\"aligncenter\" title=\"GitHub\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/eb928ec5ffe78a74df84b376c33b30a8.png\" alt=\"GitHub\"></p>\n<p>截至目前，我们有两个分支：一个是 <code>master</code> 分支，只有一个 <code>README.md</code> 文件；另一个是 <code>myBranch</code> 分支，有两个文件。</p>\n<p>你已经知道如何创建分支了，下面我们再创建一个分支。输入如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e64933687f163862866\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit checkout master\r\ngit checkout -b myBranch2\r\ntouch newFile2\r\ngit add newFile2\r\ngit commit -m \"Adding newFile2 to myBranch2\"\r\ngit push origin myBranch2\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e64933687f163862866-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933687f163862866-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e64933687f163862866-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933687f163862866-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b1e64933687f163862866-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e64933687f163862866-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b1e64933687f163862866-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e64933687f163862866-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">checkout </span><span class=\"crayon-e\">master</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933687f163862866-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">checkout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">myBranch2</span></div><div class=\"crayon-line\" id=\"crayon-5b1e64933687f163862866-3\"><span class=\"crayon-e\">touch </span><span class=\"crayon-e\">newFile2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933687f163862866-4\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">newFile2</span></div><div class=\"crayon-line\" id=\"crayon-5b1e64933687f163862866-5\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Adding newFile2 to myBranch2\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e64933687f163862866-6\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">push </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">myBranch2</span></div><div class=\"crayon-line\" id=\"crayon-5b1e64933687f163862866-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>我不再给出终端输出，需要你自己尝试，但你可以在 <a href=\"https://github.com/kedark3/Demo/tree/myBranch2\">GitHub 代码库</a> 中验证你的结果。</p>\n<h3 id=\"toc_3\">删除分支</h3>\n<p>由于我们增加了两个分支，下面删除其中的一个（<code>myBranch</code>），包括两步：</p>\n<ol>\n<li><strong>删除本地分支</strong> 你不能删除正在操作的分支，故切换到 <code>master</code> 分支 （或其它你希望保留的分支），命令及终端输出如下：<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/e1b4762c1603c531f92cc662147e319d.png\" alt=\"\"><code>git branch</code> 可以列出可用的分支，使用 <code>checkout</code> 切换到 <code>master</code> 分支，然后使用 <code>git branch -D myBranch</code> 删除该分支。再次运行 <code>git branch</code> 检查是否只剩下两个分支（而不是三个）。</li>\n<li><strong>删除 GitHub 上的分支</strong> 使用如下命令删除 <code>myBranch</code> 的远程分支：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e649336883088868859\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit push origin :myBranch\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e649336883088868859-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e649336883088868859-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e649336883088868859-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">push </span><span class=\"crayon-v\">origin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">myBranch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e649336883088868859-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<br>\n<img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1b91a34117a4ea69a12a6c9f714f9def.png\" alt=\"Terminal output\"></li>\n</ol>\n<p>上面 <code>push</code> 命令中分支名称前面的冒号（<code>:</code>）告知 GitHub 删除分支。另一种写法为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e649336888615584916\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit push -d origin myBranch\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e649336888615584916-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e649336888615584916-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e649336888615584916-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">myBranch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e649336888615584916-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>其中 <code>-d</code> (也可以用 <code>--delete</code>) 也用于告知 GitHub 删除你的分支。</p>\n<p>我们学习了 Git 分支的使用，在本系列的下一篇文章中，我们将介绍如何执行 <code>fetch</code> 和 <code>rebase</code> 操作，对于多人同时的贡献的项目而言，这是很必须学会的。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114107\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114107votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114107\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,Git,Linux", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/b84f8d56e47a8496314a55a39b08ad10.jpg"], "url_object_id": "90144cba629e28c20a0e4a2ee1876768", "front_image_path": "full/0870bcb4320291e61232dfc38ab50b871c6b8c41.jpg"}
{"title": "是什么让初级工程师走投无路？", "url": "http://blog.jobbole.com/113954/", "create_time": "2018/05/24", "vote_nums": 1, "mark_nums": 1, "comment_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q3198108035\">tsteho</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/@melissamcewen/who-killed-the-junior-developer-33e9da2dc58c\">Melissa Mcewen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><em>虽然有非常多的初级工程师，但是并没有非常多的职位给他们。</em></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/1fd843979d2a6757332bedd49c9c8d80.png\" alt=\"\"></p>\n<p>几个月前，我参加了一场针对技术领域女性的活动。很多参加者中是新的开发者，毕业于编程学校或者计算机科学课程。几乎所有人都告诉我，她们在获得第一份工作时遇到了麻烦。</p>\n<p>我很幸运。我在大学的第一份“真正”工作是 2010 年哥伦比亚大学的“初级应用程序开发人员”。现如今，甚至找不到一个招聘初级开发者岗位的招聘帖。发这些招聘帖的人说他们被淹没在了简历中。然而优秀的公司又抱怨找不到好的工程师。</p>\n<p>我想知道这是为什么？</p>\n<p>我不知道这样做，具体来说能够为我们节省多少成本，毕竟我不参与公司的运营。但是我知道很多公司对我说过：「我们不雇佣初级工程师的原因是，<strong>让高级工程师花时间给他们提供指导，对我们来说成本太高了</strong>。」我已经了解高级工程师的价格，因为我就是其中之一，并且为了预估项目预算，项目经理曾让我给项目分配时间。我知道的价格区间是 190 ~ 300 美元每小时。这就是很多公司认为雇佣初级工程师是一笔损失的原因。</p>\n<p>我并不这么认为：没有高级工程师能够一直高效工作一整天。公司对人力成本的焦虑就像鳄鱼的眼泪，（至少以我的观点来说）他们刻意不去思考浪费在很多事物上的时间，比如开会。</p>\n<p>但让我们来做个假设，他们将初级开发者的职位重新加入到团队。另一个问题出现了：<strong>高级工程师根本没有与初级工程师合作或者培训他人的经验</strong>。当我第一次开始与初级工程师合作时，我不知道该如何去做。我感到迷茫和困惑。我所待的公司基本上就是这样的态度：“让他们有事可做，让他们可以从中学到东西。”但是，这样做真的不可持续。</p>\n<p>我寻找资源，但是并没有找到。如果你知道任何资源，请在留言中通知我。我最终拼凑了各种课程和不同作业。</p>\n<p>但令人惊叹的是，我在做这件事时学到了很多东西。直到我必须解释 Javascript 语言的特性，我才觉得我真的深入地理解了它们。我为教学开发的一些工具最终付诸于项目。</p>\n<p>现在，有一些时候令我感到沮丧。特别是当项目经理或其他经理不了解现实状况的时候。他们总觉得，这些人教了就马上能够进行开发，但这之间有个消化和理解的过程。</p>\n<p>我认为我想说的是：整个软件开发生态系统需要初级工程师以保持健康。培训他们有成本，但也有好处。</p>\n<p>我建议那些想要再次招聘初级工程师的公司，投入一些时间用来制定一个大纲，用来帮助高级工程师以及任何与他们合作的人员有效地辅导。并且说明下这个严峻的现实。</p>\n<p>就像<strong>并不是所有初级工程师能够成为成功的开发者</strong>。那样的话，你会做什么呢？抱怨辅导你的高级工程师？或者追逐那些奋斗于通往成功领域（如项目管理、销售工程师或者其他非开发的角色）的人。在这些领域，软件技能也是非常重要的。</p>\n<p>并且<strong>并不是所有的高级工程师能够成为成功的导师</strong>。很多杰出的工程师不具备这一特质。他们应该避免扮演这样的角色。对于那些必须担任导师这一角色的人，如果他们没做好，我们也不应该苛责他们。我曾在一个团队中给初级开发者提供大部分的指导。与其他工程师所做的工作相比，这被认为不是“真正”的工作，这后来也让我不太愿意担当这个角色。是的，我会将性别考虑进去，因为我是一位女性，并且当女性担任类似这种角色，受刻板印象的影响，她们总被认为是“训导员”。那意味着更低的声誉，更低的声誉意味着更少的工资。</p>\n<p>话虽这么说，但如果没有提及一些其他阻碍初级工程师的经济问题，我不足以写下这篇文章。最近，因为一个活动，我拜访了一家公司，他们大概的意思就是说，现在所有“容易”的工作都已外包给另一个国家。这些工作以前都是初级工程师做的。之后有了自动化。我还是初级工程师时许多需要亲自做的工作，现在都可以自动化处理了。</p>\n<p>对于那些初级工程师，找到你的第一份工作正变得越来越困难。你可能不得不做一些我不愿意推荐的事，比如免费给各种项目打工。<strong>如果你确实选择了一个非常好的开源项目，你可以将它写到简历上</strong>。我<strong>不太倾向于推荐为“创业公司”免费打工</strong>。</p>\n<p>你也要寻找你自己的导师。现场见面会是最好的方式，虽然我明白并不是每个人都喜欢这样，因此你可以试试 Slack 和 Discord 聊天应用。不过就像很多约会一样，这也会变得糟糕。你将被多次的拒绝。你将做一些糟糕的、甚至完全失败的项目，因为和商业项目的人员相比，免费项目的工作人员一般有点更古里古怪。就像一个初级工程师告诉我的：他们不再去某个见面会，因为他们之前做的项目彻底地失败了。我不得不告诉他们应该继续寻找项目，但心中要明白大多数项目都不是完善的。</p>\n<p>对我而言，我很高兴为参加见面会的人提供辅导。在这些背景下，我也要努力地制定一份更正式的导师计划。</p>\n<p>我不确定整个行业的解决方案是什么。我不确定缺乏初级工程师的公司是不平衡的还是聪明的。实际情况是，大多数软件开发人员不会长时间呆在一个地方，所以也许投入大量资源来培训人员是没有意义的。或者说，这个行业也许应该问问自己，为什么人们不停地跳槽？也许是因为大多数公司都很糟糕，或者对我们很多人来说，这是提高薪水的唯一途径。我可以等待一个愚蠢的、毫无意义的年度“绩效评估”让我涨 1％ 的工资。或者投递简历，通过面试，拿到 10％ 或更多的工资涨幅。</p>\n<p><strong>这不仅仅是个别公司不够完善的信号，也是整个行业不够完善的信号。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113954\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113954votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113954\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3198108035\">tsteho</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3198108035\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/78BB6F88A07D4D78DB552CAD9BD3D689/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Python爱好者        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q3198108035\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q3198108035/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q3198108035/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a> · <a title=\"QQ：3280767506\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "职场,程序员,职场", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/1fd843979d2a6757332bedd49c9c8d80.png"], "url_object_id": "cda2e6399ff30560f3a49b7fb8c7280a", "front_image_path": "full/c387e396af4df71c22f480eba98289a1e8a86b87.jpg"}
{"title": "我必须得告诉大家的MySQL优化原理", "url": "http://blog.jobbole.com/114041/", "create_time": "2018/05/25", "vote_nums": 3, "mark_nums": 9, "comment_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.jianshu.com/p/d7665192aaaf\">CHEN川</a>   </div><p>说起MySQL的查询优化，相信大家收藏了一堆奇技淫巧：不能使用<code>SELECT *</code>、不使用NULL字段、合理创建索引、为字段选择合适的数据类型….. 你是否真的理解这些优化技巧？是否理解其背后的工作原理？在实际场景下性能真有提升吗？我想未必。因而理解这些优化建议背后的原理就尤为重要，希望本文能让你重新审视这些优化建议，并在实际业务场景下合理的运用。</p>\n<h3>MySQL逻辑架构</h3>\n<p>如果能在头脑中构建一幅MySQL各组件之间如何协同工作的架构图，有助于深入理解MySQL服务器。下图展示了MySQL的逻辑架构图。</p>\n<div>\n<div>\n<div> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frnqlou40xj207p07dq32.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">MySQL逻辑架构，来自：高性能MySQL</div>\n</div>\n<p>MySQL逻辑架构整体分为三层，最上层为客户端层，并非MySQL所独有，诸如：连接处理、授权认证、安全等功能均在这一层处理。</p>\n<p>MySQL大多数核心服务均在中间这一层，包括查询解析、分析、优化、缓存、内置函数(比如：时间、数学、加密等函数)。所有的跨存储引擎的功能也在这一层实现：存储过程、触发器、视图等。</p>\n<p>最下层为存储引擎，其负责MySQL中的数据存储和提取。和Linux下的文件系统类似，每种存储引擎都有其优势和劣势。中间的服务层通过API与存储引擎通信，这些API接口屏蔽了不同存储引擎间的差异。</p>\n<h3>MySQL查询过程</h3>\n<p>我们总是希望MySQL能够获得更高的查询性能，最好的办法是弄清楚MySQL是如何优化和执行查询的。一旦理解了这一点，就会发现：<strong>很多的查询优化工作实际上就是遵循一些原则让MySQL的优化器能够按照预想的合理方式运行而已。</strong></p>\n<p>当向MySQL发送一个请求的时候，MySQL到底做了些什么呢？</p>\n<div>\n<div>\n<div> <img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1frnqlp7c08j20jg0beacl.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">MySQL查询过程</div>\n</div>\n<h4>客户端/服务端通信协议</h4>\n<p>MySQL客户端/服务端通信协议是“半双工”的：在任一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生。一旦一端开始发送消息，另一端要接收完整个消息才能响应它，所以我们无法也无须将一个消息切成小块独立发送，也没有办法进行流量控制。</p>\n<p>客户端用一个单独的数据包将查询请求发送给服务器，所以当查询语句很长的时候，需要设置<code>max_allowed_packet</code>参数。但是需要注意的是，如果查询实在是太大，服务端会拒绝接收更多数据并抛出异常。</p>\n<p>与之相反的是，服务器响应给用户的数据通常会很多，由多个数据包组成。但是当服务器响应客户端请求时，客户端必须完整的接收整个返回结果，而不能简单的只取前面几条结果，然后让服务器停止发送。因而在实际开发中，尽量保持查询简单且只返回必需的数据，减小通信间数据包的大小和数量是一个非常好的习惯，这也是查询中尽量避免使用<code>SELECT *</code>以及加上<code>LIMIT</code>限制的原因之一。</p>\n<h4>查询缓存</h4>\n<p>在解析一个查询语句前，如果查询缓存是打开的，那么MySQL会检查这个查询语句是否命中查询缓存中的数据。如果当前查询恰好命中查询缓存，在检查一次用户权限后直接返回缓存中的结果。这种情况下，查询不会被解析，也不会生成执行计划，更不会执行。</p>\n<p>MySQL将缓存存放在一个引用表（不要理解成<code>table</code>，可以认为是类似于<code>HashMap</code>的数据结构），通过一个哈希值索引，这个哈希值通过查询本身、当前要查询的数据库、客户端协议版本号等一些可能影响结果的信息计算得来。所以两个查询在任何字符上的不同（例如：空格、注释），都会导致缓存不会命中。</p>\n<p>如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、mysql库中的系统表，其查询结果<br>\n都不会被缓存。比如函数<code>NOW()</code>或者<code>CURRENT_DATE()</code>会因为不同的查询时间，返回不同的查询结果，再比如包含<code>CURRENT_USER</code>或者<code>CONNECION_ID()</code>的查询语句会因为不同的用户而返回不同的结果，将这样的查询结果缓存起来没有任何的意义。</p>\n<p>既然是缓存，就会失效，那查询缓存何时失效呢？MySQL的查询缓存系统会跟踪查询中涉及的每个表，如果这些表（数据或结构）发生变化，那么和这张表相关的所有缓存数据都将失效。正因为如此，在任何的写操作时，MySQL必须将对应表的所有缓存都设置为失效。如果查询缓存非常大或者碎片很多，这个操作就可能带来很大的系统消耗，甚至导致系统僵死一会儿。而且查询缓存对系统的额外消耗也不仅仅在写操作，读操作也不例外：</p>\n<ol>\n<li>任何的查询语句在开始之前都必须经过检查，即使这条SQL语句永远不会命中缓存</li>\n<li>如果查询结果可以被缓存，那么执行完成后，会将结果存入缓存，也会带来额外的系统消耗</li>\n</ol>\n<p>基于此，我们要知道并不是什么情况下查询缓存都会提高系统性能，缓存和失效都会带来额外消耗，只有当缓存带来的资源节约大于其本身消耗的资源时，才会给系统带来性能提升。但要如何评估打开缓存是否能够带来性能提升是一件非常困难的事情，也不在本文讨论的范畴内。如果系统确实存在一些性能问题，可以尝试打开查询缓存，并在数据库设计上做一些优化，比如：</p>\n<ol>\n<li>用多个小表代替一个大表，注意不要过度设计</li>\n<li>批量插入代替循环单条插入</li>\n<li>合理控制缓存空间大小，一般来说其大小设置为几十兆比较合适</li>\n<li>可以通过<code>SQL_CACHE</code>和<code>SQL_NO_CACHE</code>来控制某个查询语句是否需要进行缓存</li>\n</ol>\n<p>最后的忠告是不要轻易打开查询缓存，特别是写密集型应用。如果你实在是忍不住，可以将<code>query_cache_type</code>设置为<code>DEMAND</code>，这时只有加入<code>SQL_CACHE</code>的查询才会走缓存，其他查询则不会，这样可以非常自由地控制哪些查询需要被缓存。</p>\n<p>当然查询缓存系统本身是非常复杂的，这里讨论的也只是很小的一部分，其他更深入的话题，比如：缓存是如何使用内存的？如何控制内存的碎片化？事务对查询缓存有何影响等等，读者可以自行阅读相关资料，这里权当抛砖引玉吧。</p>\n<h4>语法解析和预处理</h4>\n<p>MySQL通过关键字将SQL语句进行解析，并生成一颗对应的解析树。这个过程解析器主要通过语法规则来验证和解析。比如SQL中是否使用了错误的关键字或者关键字的顺序是否正确等等。预处理则会根据MySQL规则进一步检查解析树是否合法。比如检查要查询的数据表和数据列是否存在等等。</p>\n<h4>查询优化</h4>\n<p>经过前面的步骤生成的语法树被认为是合法的了，并且由优化器将其转化成查询计划。多数情况下，一条查询可以有很多种执行方式，最后都返回相应的结果。优化器的作用就是找到这其中最好的执行计划。</p>\n<p>MySQL使用基于成本的优化器，它尝试预测一个查询使用某种执行计划时的成本，并选择其中成本最小的一个。在MySQL可以通过查询当前会话的<code>last_query_cost</code>的值来得到其计算当前查询的成本。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca47489636826\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmysql&gt; select * from t_message limit 10;\r\n...省略结果集\r\n\r\nmysql&gt; show status like 'last_query_cost';\r\n+-----------------+-------------+\r\n| Variable_name   | Value       |\r\n+-----------------+-------------+\r\n| Last_query_cost | 6391.799000 |\r\n+-----------------+-------------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca47489636826-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca47489636826-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca47489636826-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca47489636826-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca47489636826-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca47489636826-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca47489636826-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca47489636826-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca47489636826-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca47489636826-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca47489636826-1\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">t_message </span><span class=\"crayon-i\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca47489636826-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span>省略结果集</div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca47489636826-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca47489636826-4\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">status </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'last_query_cost'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca47489636826-5\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca47489636826-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca47489636826-7\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca47489636826-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Last_query_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6391.799000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca47489636826-9\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca47489636826-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>示例中的结果表示优化器认为大概需要做6391个数据页的随机查找才能完成上面的查询。这个结果是根据一些列的统计信息计算得来的，这些统计信息包括：每张表或者索引的页面个数、索引的基数、索引和数据行的长度、索引的分布情况等等。</p>\n<p>有非常多的原因会导致MySQL选择错误的执行计划，比如统计信息不准确、不会考虑不受其控制的操作成本（用户自定义函数、存储过程）、MySQL认为的最优跟我们想的不一样（我们希望执行时间尽可能短，但MySQL值选择它认为成本小的，但成本小并不意味着执行时间短）等等。</p>\n<p>MySQL的查询优化器是一个非常复杂的部件，它使用了非常多的优化策略来生成一个最优的执行计划：</p>\n<ul>\n<li>重新定义表的关联顺序（多张表关联查询时，并不一定按照SQL中指定的顺序进行，但有一些技巧可以指定关联顺序）</li>\n<li>优化<code>MIN()</code>和<code>MAX()</code>函数（找某列的最小值，如果该列有索引，只需要查找B+Tree索引最左端，反之则可以找到最大值，具体原理见下文）</li>\n<li>提前终止查询（比如：使用Limit时，查找到满足数量的结果集后会立即终止查询）</li>\n<li>优化排序（在老版本MySQL会使用两次传输排序，即先读取行指针和需要排序的字段在内存中对其排序，然后再根据排序结果去读取数据行，而新版本采用的是单次传输排序，也就是一次读取所有的数据行，然后根据给定的列排序。对于I/O密集型应用，效率会高很多）</li>\n</ul>\n<p>随着MySQL的不断发展，优化器使用的优化策略也在不断的进化，这里仅仅介绍几个非常常用且容易理解的优化策略，其他的优化策略，大家自行查阅吧。</p>\n<h4>查询执行引擎</h4>\n<p>在完成解析和优化阶段以后，MySQL会生成对应的执行计划，查询执行引擎根据执行计划给出的指令逐步执行得出结果。整个执行过程的大部分操作均是通过调用存储引擎实现的接口来完成，这些接口被称为<code>handler API</code>。查询过程中的每一张表由一个<code>handler</code>实例表示。实际上，MySQL在查询优化阶段就为每一张表创建了一个<code>handler</code>实例，优化器可以根据这些实例的接口来获取表的相关信息，包括表的所有列名、索引统计信息等。存储引擎接口提供了非常丰富的功能，但其底层仅有几十个接口，这些接口像搭积木一样完成了一次查询的大部分操作。</p>\n<h4>返回结果给客户端</h4>\n<p>查询执行的最后一个阶段就是将结果返回给客户端。即使查询不到数据，MySQL仍然会返回这个查询的相关信息，比如该查询影响到的行数以及执行时间等等。</p>\n<p>如果查询缓存被打开且这个查询可以被缓存，MySQL也会将结果存放到缓存中。</p>\n<p>结果集返回客户端是一个增量且逐步返回的过程。有可能MySQL在生成第一条结果时，就开始向客户端逐步返回结果集了。这样服务端就无须存储太多结果而消耗过多内存，也可以让客户端第一时间获得返回结果。需要注意的是，结果集中的每一行都会以一个满足①中所描述的通信协议的数据包发送，再通过TCP协议进行传输，在传输过程中，可能对MySQL的数据包进行缓存然后批量发送。</p>\n<p>回头总结一下MySQL整个查询执行过程，总的来说分为6个步骤：</p>\n<ol>\n<li>客户端向MySQL服务器发送一条查询请求</li>\n<li>服务器首先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段</li>\n<li>服务器进行SQL解析、预处理、再由优化器生成对应的执行计划</li>\n<li>MySQL根据执行计划，调用存储引擎的API来执行查询</li>\n<li>将结果返回给客户端，同时缓存查询结果</li>\n</ol>\n<h3>性能优化建议</h3>\n<p>看了这么多，你可能会期待给出一些优化手段，是的，下面会从3个不同方面给出一些优化建议。但请等等，还有一句忠告要先送给你：<strong>不要听信你看到的关于优化的“绝对真理”，包括本文所讨论的内容，而应该是在实际的业务场景下通过测试来验证你关于执行计划以及响应时间的假设</strong>。</p>\n<h4>Scheme设计与数据类型优化</h4>\n<p>选择数据类型只要遵循<strong>小而简单</strong>的原则就好，越小的数据类型通常会更快，占用更少的磁盘、内存，处理时需要的CPU周期也更少。越简单的数据类型在计算时需要更少的CPU周期，比如，整型就比字符操作代价低，因而会使用整型来存储ip地址，使用<code>DATETIME</code>来存储时间，而不是使用字符串。</p>\n<p>这里总结几个可能容易理解错误的技巧：</p>\n<ol>\n<li>通常来说把可为<code>NULL</code>的列改为<code>NOT NULL</code>不会对性能提升有多少帮助，只是如果计划在列上创建索引，就应该将该列设置为<code>NOT NULL</code>。</li>\n<li>对整数类型指定宽度，比如<code>INT(11)</code>，没有任何卵用。<code>INT</code>使用32位（4个字节）存储空间，那么它的表示范围已经确定，所以<code>INT(1)</code>和<code>INT(20)</code>对于存储和计算是相同的。</li>\n<li><code>UNSIGNED</code>表示不允许负值，大致可以使正数的上限提高一倍。比如<code>TINYINT</code>存储范围是-128 ~ 127，而<code>UNSIGNED TINYINT</code>存储的范围却是0 – 255。</li>\n<li>通常来讲，没有太大的必要使用<code>DECIMAL</code>数据类型。即使是在需要存储财务数据时，仍然可以使用<code>BIGINT</code>。比如需要精确到万分之一，那么可以将数据乘以一百万然后使用<code>BIGINT</code>存储。这样可以避免浮点数计算不准确和<code>DECIMAL</code>精确计算代价高的问题。</li>\n<li><code>TIMESTAMP</code>使用4个字节存储空间，<code>DATETIME</code>使用8个字节存储空间。因而，<code>TIMESTAMP</code>只能表示1970 – 2038年，比<code>DATETIME</code>表示的范围小得多，而且<code>TIMESTAMP</code>的值因时区不同而不同。</li>\n<li>大多数情况下没有使用枚举类型的必要，其中一个缺点是枚举的字符串列表是固定的，添加和删除字符串（枚举选项）必须使用<code>ALTER TABLE</code>（如果只只是在列表末尾追加元素，不需要重建表）。</li>\n<li>schema的列不要太多。原因是存储引擎的API工作时需要在服务器层和存储引擎层之间通过行缓冲格式拷贝数据，然后在服务器层将缓冲内容解码成各个列，这个转换过程的代价是非常高的。如果列太多而实际使用的列又很少的话，有可能会导致CPU占用过高。</li>\n<li>大表<code>ALTER TABLE</code>非常耗时，MySQL执行大部分修改表结果操作的方法是用新的结构创建一个张空表，从旧表中查出所有的数据插入新表，然后再删除旧表。尤其当内存不足而表又很大，而且还有很大索引的情况下，耗时更久。当然有一些奇技淫巧可以解决这个问题，有兴趣可自行查阅。</li>\n</ol>\n<h4>创建高性能索引</h4>\n<p>索引是提高MySQL查询性能的一个重要途径，但过多的索引可能会导致过高的磁盘使用率以及过高的内存占用，从而影响应用程序的整体性能。应当尽量避免事后才想起添加索引，因为事后可能需要监控大量的SQL才能定位到问题所在，而且添加索引的时间肯定是远大于初始添加索引所需要的时间，可见索引的添加也是非常有技术含量的。</p>\n<p>接下来将向你展示一系列创建高性能索引的策略，以及每条策略其背后的工作原理。但在此之前，先了解与索引相关的一些算法和数据结构，将有助于更好的理解后文的内容。</p>\n<h5>索引相关的数据结构和算法</h5>\n<p>通常我们所说的索引是指<code>B-Tree</code>索引，它是目前关系型数据库中查找数据最为常用和有效的索引，大多数存储引擎都支持这种索引。使用<code>B-Tree</code>这个术语，是因为MySQL在<code>CREATE TABLE</code>或其它语句中使用了这个关键字，但实际上不同的存储引擎可能使用不同的数据结构，比如InnoDB就是使用的<code>B+Tree</code>。</p>\n<p><code>B+Tree</code>中的B是指<code>balance</code>，意为平衡。需要注意的是，B+树索引并不能找到一个给定键值的具体行，它找到的只是被查找数据行所在的页，接着数据库会把页读入到内存，再在内存中进行查找，最后得到要查找的数据。</p>\n<p>在介绍<code>B+Tree</code>前，先了解一下二叉查找树，它是一种经典的数据结构，其左子树的值总是小于根的值，右子树的值总是大于根的值，如下图①。如果要在这课树中查找值为5的记录，其大致流程：先找到根，其值为6，大于5，所以查找左子树，找到3，而5大于3，接着找3的右子树，总共找了3次。同样的方法，如果查找值为8的记录，也需要查找3次。所以二叉查找树的平均查找次数为(3 + 3 + 3 + 2 + 2 + 1) / 6 = 2.3次，而顺序查找的话，查找值为2的记录，仅需要1次，但查找值为8的记录则需要6次，所以顺序查找的平均查找次数为：(1 + 2 + 3 + 4 + 5 + 6) / 6 = 3.3次，因此大多数情况下二叉查找树的平均查找速度比顺序查找要快。</p>\n<div>\n<div>\n<div> <img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1frnqlpnol6j20h606gglv.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">二叉查找树和平衡二叉树</div>\n</div>\n<p>由于二叉查找树可以任意构造，同样的值，可以构造出如图②的二叉查找树，显然这棵二叉树的查询效率和顺序查找差不多。若想二叉查找数的查询性能最高，需要这棵二叉查找树是平衡的，也即平衡二叉树（AVL树）。</p>\n<p>平衡二叉树首先需要符合二叉查找树的定义，其次必须满足任何节点的两个子树的高度差不能大于1。显然图②不满足平衡二叉树的定义，而图①是一课平衡二叉树。平衡二叉树的查找性能是比较高的（性能最好的是最优二叉树），查询性能越好，维护的成本就越大。比如图①的平衡二叉树，当用户需要插入一个新的值9的节点时，就需要做出如下变动。</p>\n<div>\n<div>\n<div> <img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1frnqlq46oqj20ey069q39.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">平衡二叉树旋转</div>\n</div>\n<p>通过一次左旋操作就将插入后的树重新变为平衡二叉树是最简单的情况了，实际应用场景中可能需要旋转多次。至此我们可以考虑一个问题，平衡二叉树的查找效率还不错，实现也非常简单，相应的维护成本还能接受，为什么MySQL索引不直接使用平衡二叉树？</p>\n<p>随着数据库中数据的增加，索引本身大小随之增加，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上。这样的话，索引查找过程中就要产生磁盘I/O消耗，相对于内存存取，I/O存取的消耗要高几个数量级。可以想象一下一棵几百万节点的二叉树的深度是多少？如果将这么大深度的一颗二叉树放磁盘上，每读取一个节点，需要一次磁盘的I/O读取，整个查找的耗时显然是不能够接受的。那么如何减少查找过程中的I/O存取次数？</p>\n<p>一种行之有效的解决方法是减少树的深度，将二叉树变为m叉树（多路搜索树），而<code>B+Tree</code>就是一种多路搜索树。理解<code>B+Tree</code>时，只需要理解其最重要的两个特征即可：第一，所有的关键字（可以理解为数据）都存储在叶子节点（<code>Leaf Page</code>），非叶子节点（<code>Index Page</code>）并不存储真正的数据，所有记录节点都是按键值大小顺序存放在同一层叶子节点上。其次，所有的叶子节点由指针连接。如下图为高度为2的简化了的<code>B+Tree</code>。</p>\n<div>\n<div>\n<div> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frnqlqkcsmj20jg04ymx9.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">简化B+Tree</div>\n</div>\n<p>怎么理解这两个特征？MySQL将每个节点的大小设置为一个页的整数倍（原因下文会介绍），也就是在节点空间大小一定的情况下，每个节点可以存储更多的内结点，这样每个结点能索引的范围更大更精确。所有的叶子节点使用指针链接的好处是可以进行区间访问，比如上图中，如果查找大于20而小于30的记录，只需要找到节点20，就可以遍历指针依次找到25、30。如果没有链接指针的话，就无法进行区间查找。这也是MySQL使用<code>B+Tree</code>作为索引存储结构的重要原因。</p>\n<p>MySQL为何将节点大小设置为页的整数倍，这就需要理解磁盘的存储原理。磁盘本身存取就比主存慢很多，在加上机械运动损耗（特别是普通的机械硬盘），磁盘的存取速度往往是主存的几百万分之一，为了尽量减少磁盘I/O，磁盘往往不是严格按需读取，而是每次都会预读，即使只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存，预读的长度一般为页的整数倍。</p>\n<blockquote><p>页是计算机管理存储器的逻辑块，硬件及OS往往将主存和磁盘存储区分割为连续的大小相等的块，每个存储块称为一页（许多OS中，页的大小通常为4K）。主存和磁盘以页为单位交换数据。当程序要读取的数据不在主存中时，会触发一个缺页异常，此时系统会向磁盘发出读盘信号，磁盘会找到数据的起始位置并向后连续读取一页或几页载入内存中，然后一起返回，程序继续运行。</p></blockquote>\n<p>MySQL巧妙利用了磁盘预读原理，将一个节点的大小设为等于一个页，这样每个节点只需要一次I/O就可以完全载入。为了达到这个目的，每次新建节点时，直接申请一个页的空间，这样就保证一个节点物理上也存储在一个页里，加之计算机存储分配都是按页对齐的，就实现了读取一个节点只需一次I/O。假设<code>B+Tree</code>的高度为h，一次检索最多需要<code>h-1</code>次I/O（根节点常驻内存），复杂度O(h) = O(logmN)。实际应用场景中，M通常较大，常常超过100，因此树的高度一般都比较小，通常不超过3。</p>\n<p>最后简单了解下<code>B+Tree</code>节点的操作，在整体上对索引的维护有一个大概的了解，虽然索引可以大大提高查询效率，但维护索引仍要花费很大的代价，因此合理的创建索引也就尤为重要。</p>\n<p>仍以上面的树为例，我们假设每个节点只能存储4个内节点。首先要插入第一个节点28，如下图所示。</p>\n<div>\n<div>\n<div> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frnqlqysrpj20jg05aaa4.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">leaf page和index page都没有满</div>\n</div>\n<p>接着插入下一个节点70，在Index Page中查询后得知应该插入到50 – 70之间的叶子节点，但叶子节点已满，这时候就需要进行也分裂的操作，当前的叶子节点起点为50，所以根据中间值来拆分叶子节点，如下图所示。</p>\n<div>\n<div>\n<div></div>\n<div><img><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1frnqlrek5aj20jg0bft96.jpg\"></div>\n</div>\n<div style=\"text-align: center\">Leaf Page拆分</div>\n</div>\n<p>最后插入一个节点95，这时候Index Page和Leaf Page都满了，就需要做两次拆分，如下图所示。</p>\n<div>\n<div>\n<div> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frnqlrt7gcj20jg0ccgms.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">Leaf Page与Index Page拆分</div>\n</div>\n<p>拆分后最终形成了这样一颗树。</p>\n<div>\n<div>\n<div> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frnqlsibq4j20jg04iaa4.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">最终树</div>\n</div>\n<p><code>B+Tree</code>为了保持平衡，对于新插入的值需要做大量的拆分页操作，而页的拆分需要I/O操作，为了尽可能的减少页的拆分操作，<code>B+Tree</code>也提供了类似于平衡二叉树的旋转功能。当Leaf Page已满但其左右兄弟节点没有满的情况下，<code>B+Tree</code>并不急于去做拆分操作，而是将记录移到当前所在页的兄弟节点上。通常情况下，左兄弟会被先检查用来做旋转操作。就比如上面第二个示例，当插入70的时候，并不会去做页拆分，而是左旋操作。</p>\n<div>\n<div>\n<div> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frnqlstvi1j20jg0dq3yz.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">左旋操作</div>\n</div>\n<p>通过旋转操作可以最大限度的减少页分裂，从而减少索引维护过程中的磁盘的I/O操作，也提高索引维护效率。需要注意的是，删除节点跟插入节点类似，仍然需要旋转和拆分操作，这里就不再说明。</p>\n<h5>高性能策略</h5>\n<p>通过上文，相信你对<code>B+Tree</code>的数据结构已经有了大致的了解，但MySQL中索引是如何组织数据的存储呢？以一个简单的示例来说明，假如有如下数据表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca60323944827\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE People(\r\n    last_name varchar(50) not null,\r\n    first_name varchar(50) not null,\r\n    dob date not null,\r\n    gender enum(`m`,`f`) not null,\r\n    key(last_name,first_name,dob)\r\n);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca60323944827-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca60323944827-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca60323944827-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca60323944827-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca60323944827-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca60323944827-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca60323944827-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca60323944827-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca60323944827-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">People</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca60323944827-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">last_name </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca60323944827-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">first_name </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca60323944827-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dob </span><span class=\"crayon-e\">date </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca60323944827-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">gender </span><span class=\"crayon-t\">enum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca60323944827-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">first_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">dob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca60323944827-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca60323944827-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>对于表中每一行数据，索引中包含了last_name、first_name、dob列的值，下图展示了索引是如何组织数据存储的。</p>\n<div>\n<div>\n<div> <img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1frnqlta58nj20jg03uglt.jpg\"></div>\n<div><img></div>\n</div>\n<div style=\"text-align: center\">索引如何组织数据存储，来自：高性能MySQL</div>\n</div>\n<p>可以看到，索引首先根据第一个字段来排列顺序，当名字相同时，则根据第三个字段，即出生日期来排序，正是因为这个原因，才有了索引的“最左原则”。</p>\n<h6>1、MySQL不会使用索引的情况：非独立的列</h6>\n<p>“独立的列”是指索引列不能是表达式的一部分，也不能是函数的参数。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca72966427465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect * from where id + 1 = 5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca72966427465-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca72966427465-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca72966427465-1\"><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca72966427465-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们很容易看出其等价于 id = 4，但是MySQL无法自动解析这个表达式，使用函数是同样的道理。</p>\n<h6>2、前缀索引</h6>\n<p>如果列很长，通常可以索引开始的部分字符，这样可以有效节约索引空间，从而提高索引效率。</p>\n<h6>3、多列索引和索引顺序</h6>\n<p>在多数情况下，在多个列上建立独立的索引并不能提高查询性能。理由非常简单，MySQL不知道选择哪个索引的查询效率更好，所以在老版本，比如MySQL5.0之前就会随便选择一个列的索引，而新的版本会采用合并索引的策略。举个简单的例子，在一张电影演员表中，在actor_id和film_id两个列上都建立了独立的索引，然后有如下查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca78749052270\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect film_id,actor_id from film_actor where actor_id = 1 or film_id = 1\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca78749052270-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca78749052270-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca78749052270-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-v\">film_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">actor_id </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">film_actor </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">actor_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">film_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca78749052270-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>老版本的MySQL会随机选择一个索引，但新版本做如下的优化：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca7c012815196\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect film_id,actor_id from film_actor where actor_id = 1 \r\nunion all \r\nselect film_id,actor_id from film_actor where film_id = 1 and actor_id &lt;&gt; 1\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca7c012815196-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca7c012815196-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca7c012815196-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca7c012815196-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca7c012815196-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-v\">film_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">actor_id </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">film_actor </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">actor_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca7c012815196-2\"><span class=\"crayon-e\">union </span><span class=\"crayon-e\">all </span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca7c012815196-3\"><span class=\"crayon-e\">select </span><span class=\"crayon-v\">film_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">actor_id </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">film_actor </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">film_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">actor_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca7c012815196-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<ul>\n<li>当出现多个索引做相交操作时（多个AND条件），通常来说一个包含所有相关列的索引要优于多个独立索引。</li>\n<li>当出现多个索引做联合操作时（多个OR条件），对结果集的合并、排序等操作需要耗费大量的CPU和内存资源，特别是当其中的某些索引的选择性不高，需要返回合并大量数据时，查询成本更高。所以这种情况下还不如走全表扫描。</li>\n</ul>\n<p>因此<code>explain</code>时如果发现有索引合并（Extra字段出现<code>Using union</code>），应该好好检查一下查询和表结构是不是已经是最优的，如果查询和表都没有问题，那只能说明索引建的非常糟糕，应当慎重考虑索引是否合适，有可能一个包含所有相关列的多列索引更适合。</p>\n<p>前面我们提到过索引如何组织数据存储的，从图中可以看到多列索引时，索引的顺序对于查询是至关重要的，很明显应该把选择性更高的字段放到索引的前面，这样通过第一个字段就可以过滤掉大多数不符合条件的数据。</p>\n<blockquote><p><strong>索引选择性</strong>是指不重复的索引值和数据表的总记录数的比值，选择性越高查询效率越高，因为选择性越高的索引可以让MySQL在查询时过滤掉更多的行。唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p></blockquote>\n<p>理解索引选择性的概念后，就不难确定哪个字段的选择性较高了，查一下就知道了，比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca81162144157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM payment where staff_id = 2 and customer_id = 584\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca81162144157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca81162144157-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca81162144157-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">payment </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">staff_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">customer_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">584</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca81162144157-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>是应该创建<code>(staff_id,customer_id)</code>的索引还是应该颠倒一下顺序？执行下面的查询，哪个字段的选择性更接近1就把哪个字段索引前面就好。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca84020641836\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect count(distinct staff_id)/count(*) as staff_id_selectivity,\r\n       count(distinct customer_id)/count(*) as customer_id_selectivity,\r\n       count(*) from payment\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca84020641836-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca84020641836-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca84020641836-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca84020641836-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca84020641836-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">distinct </span><span class=\"crayon-v\">staff_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">staff_id_selectivity</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca84020641836-2\"><span class=\"crayon-h\">       </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">distinct </span><span class=\"crayon-v\">customer_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">customer_id_selectivity</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca84020641836-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">payment</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca84020641836-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>多数情况下使用这个原则没有任何问题，但仍然注意你的数据中是否存在一些特殊情况。举个简单的例子，比如要查询某个用户组下有过交易的用户信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca87271344832\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect user_id from trade where user_group_id = 1 and trade_amount &gt; 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca87271344832-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca87271344832-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca87271344832-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-e\">user_id </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">trade </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">user_group_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trade_amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca87271344832-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>MySQL为这个查询选择了索引<code>(user_group_id,trade_amount)</code>，如果不考虑特殊情况，这看起来没有任何问题，但实际情况是这张表的大多数数据都是从老系统中迁移过来的，由于新老系统的数据不兼容，所以就给老系统迁移过来的数据赋予了一个默认的用户组。这种情况下，通过索引扫描的行数跟全表扫描基本没什么区别，索引也就起不到任何作用。</p>\n<p>推广开来说，经验法则和推论在多数情况下是有用的，可以指导我们开发和设计，但实际情况往往会更复杂，实际业务场景下的某些特殊情况可能会摧毁你的整个设计。</p>\n<h6>4、避免多个范围条件</h6>\n<p>实际开发中，我们会经常使用多个范围条件，比如想查询某个时间段内登录过的用户：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca8d394465287\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect user.* from user where login_time &gt; '2017-04-01' and age between 18 and 30;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca8d394465287-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca8d394465287-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca8d394465287-1\"><span class=\"crayon-e\">select </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">user </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">login_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2017-04-01'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">age </span><span class=\"crayon-i\">between</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca8d394465287-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这个查询有一个问题：它有两个范围条件，login_time列和age列，MySQL可以使用login_time列的索引或者age列的索引，但无法同时使用它们。</p>\n<h6>5、覆盖索引</h6>\n<p>如果一个索引包含或者说覆盖所有需要查询的字段的值，那么就没有必要再回表查询，这就称为覆盖索引。覆盖索引是非常有用的工具，可以极大的提高性能，因为查询只需要扫描索引会带来许多好处：</p>\n<ul>\n<li>索引条目远小于数据行大小，如果只读取索引，极大减少数据访问量</li>\n<li>索引是有按照列值顺序存储的，对于I/O密集型的范围查询要比随机从磁盘读取每一行数据的IO要少的多</li>\n</ul>\n<h6>6、使用索引扫描来排序</h6>\n<p>MySQL有两种方式可以生产有序的结果集，其一是对结果集进行排序的操作，其二是按照索引顺序扫描得出的结果自然是有序的。如果explain的结果中<code>type</code>列的值为<code>index</code>表示使用了索引扫描来做排序。</p>\n<p>扫描索引本身很快，因为只需要从一条索引记录移动到相邻的下一条记录。但如果索引本身不能覆盖所有需要查询的列，那么就不得不每扫描一条索引记录就回表查询一次对应的行。这个读取操作基本上是随机I/O，因此按照索引顺序读取数据的速度通常要比顺序地全表扫描要慢。</p>\n<p>在设计索引时，如果一个索引既能够满足排序，又满足查询，是最好的。</p>\n<p>只有当索引的列顺序和<code>ORDER BY</code>子句的顺序完全一致，并且所有列的排序方向也一样时，才能够使用索引来对结果做排序。如果查询需要关联多张表，则只有<code>ORDER BY</code>子句引用的字段全部为第一张表时，才能使用索引做排序。<code>ORDER BY</code>子句和查询的限制是一样的，都要满足最左前缀的要求（有一种情况例外，就是最左的列被指定为常数，下面是一个简单的示例），其他情况下都需要执行排序操作，而无法利用索引排序。</p>\n<blockquote><p>\n</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca92868756579\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 最左列为常数，索引：(date,staff_id,customer_id)\r\nselect  staff_id,customer_id from demo where date = '2015-06-01' order by staff_id,customer_id\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca92868756579-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca92868756579-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca92868756579-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca92868756579-1\"><span class=\"crayon-c\">// 最左列为常数，索引：(date,staff_id,customer_id)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca92868756579-2\"><span class=\"crayon-e\">select  </span><span class=\"crayon-v\">staff_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">customer_id </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">demo </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2015-06-01'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">order </span><span class=\"crayon-e\">by </span><span class=\"crayon-v\">staff_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">customer</span><span class=\"crayon-sy\">_</span>id</div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca92868756579-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>\n</p></blockquote>\n<h6>7、冗余和重复索引</h6>\n<p>冗余索引是指在相同的列上按照相同的顺序创建的相同类型的索引，应当尽量避免这种索引，发现后立即删除。比如有一个索引<code>(A,B)</code>，再创建索引<code>(A)</code>就是冗余索引。冗余索引经常发生在为表添加新索引时，比如有人新建了索引<code>(A,B)</code>，但这个索引不是扩展已有的索引<code>(A)</code>。</p>\n<p>大多数情况下都应该尽量扩展已有的索引而不是创建新索引。但有极少情况下出现性能方面的考虑需要冗余索引，比如扩展已有索引而导致其变得过大，从而影响到其他使用该索引的查询。</p>\n<h6>8、删除长期未使用的索引</h6>\n<p>定期删除一些长时间未使用过的索引是一个非常好的习惯。</p>\n<p>关于索引这个话题打算就此打住，最后要说一句，索引并不总是最好的工具，只有当索引帮助提高查询速度带来的好处大于其带来的额外工作时，索引才是有效的。对于非常小的表，简单的全表扫描更高效。对于中到大型的表，索引就非常有效。对于超大型的表，建立和维护索引的代价随之增长，这时候其他技术也许更有效，比如分区表。最后的最后，<strong><code>explain</code>后再提测是一种美德</strong>。</p>\n<h4>特定类型查询优化</h4>\n<h5>优化COUNT()查询</h5>\n<p><code>COUNT()</code>可能是被大家误解最多的函数了，它有两种不同的作用，其一是统计某个列值的数量，其二是统计行数。统计列值时，要求列值是非空的，它不会统计NULL。如果确认括号中的表达式不可能为空时，实际上就是在统计行数。最简单的就是当使用<code>COUNT(*)</code>时，并不是我们所想象的那样扩展成所有的列，实际上，它会忽略所有的列而直接统计行数。</p>\n<p>我们最常见的误解也就在这儿，在括号内指定了一列却希望统计结果是行数，而且还常常误以为前者的性能会更好。但实际并非这样，如果要统计行数，直接使用<code>COUNT(*)</code>，意义清晰，且性能更好。</p>\n<p>有时候某些业务场景并不需要完全精确的<code>COUNT</code>值，可以用近似值来代替，EXPLAIN出来的行数就是一个不错的近似值，而且执行EXPLAIN并不需要真正地去执行查询，所以成本非常低。通常来说，执行<code>COUNT()</code>都需要扫描大量的行才能获取到精确的数据，因此很难优化，MySQL层面还能做得也就只有覆盖索引了。如果不还能解决问题，只有从架构层面解决了，比如添加汇总表，或者使用redis这样的外部缓存系统。</p>\n<h5>优化关联查询</h5>\n<p>在大数据场景下，表与表之间通过一个冗余字段来关联，要比直接使用<code>JOIN</code>有更好的性能。如果确实需要使用关联查询的情况下，需要特别注意的是：</p>\n<ul>\n<li>确保<code>ON</code>和<code>USING</code>字句中的列上有索引。在创建索引的时候就要考虑到关联的顺序。当表A和表B用列c关联的时候，如果优化器关联的顺序是A、B，那么就不需要在A表的对应列上创建索引。没有用到的索引会带来额外的负担，一般来说，除非有其他理由，只需要在关联顺序中的第二张表的相应列上创建索引（具体原因下文分析）。</li>\n<li>确保任何的<code>GROUP BY</code>和<code>ORDER BY</code>中的表达式只涉及到一个表中的列，这样MySQL才有可能使用索引来优化。</li>\n</ul>\n<p>要理解优化关联查询的第一个技巧，就需要理解MySQL是如何执行关联查询的。当前MySQL关联执行的策略非常简单，它对任何的关联都执行<strong>嵌套循环关联</strong>操作，即先在一个表中循环取出单条数据，然后在嵌套循环到下一个表中寻找匹配的行，依次下去，直到找到所有表中匹配的行为为止。然后根据各个表匹配的行，返回查询中需要的各个列。</p>\n<p>太抽象了？以上面的示例来说明，比如有这样的一个查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca98120515853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT A.xx,B.yy \r\nFROM A INNER JOIN B USING(c)\r\nWHERE A.xx IN (5,6)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca98120515853-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca98120515853-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca98120515853-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca98120515853-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca98120515853-1\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">yy </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca98120515853-2\"><span class=\"crayon-i\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INNER </span><span class=\"crayon-i\">JOIN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">USING</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca98120515853-3\"><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xx </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca98120515853-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>假设MySQL按照查询中的关联顺序A、B来进行关联操作，那么可以用下面的伪代码表示MySQL如何完成这个查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0ca9d630242838\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nouter_iterator = SELECT A.xx,A.c FROM A WHERE A.xx IN (5,6);\r\nouter_row = outer_iterator.next;\r\nwhile(outer_row) {\r\n    inner_iterator = SELECT B.yy FROM B WHERE B.c = outer_row.c;\r\n    inner_row = inner_iterator.next;\r\n    while(inner_row) {\r\n        output[inner_row.yy,outer_row.xx];\r\n        inner_row = inner_iterator.next;\r\n    }\r\n    outer_row = outer_iterator.next;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0ca9d630242838-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca9d630242838-1\"><span class=\"crayon-v\">outer_iterator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xx </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca9d630242838-2\"><span class=\"crayon-v\">outer_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer_iterator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca9d630242838-3\"><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">outer_row</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca9d630242838-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">inner_iterator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">yy </span><span class=\"crayon-i\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer_row</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca9d630242838-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">inner_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inner_iterator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca9d630242838-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inner_row</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca9d630242838-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">inner_row</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">yy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">outer_row</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xx</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca9d630242838-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">inner_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inner_iterator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca9d630242838-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca9d630242838-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">outer_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer_iterator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0ca9d630242838-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0ca9d630242838-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>可以看到，最外层的查询是根据<code>A.xx</code>列来查询的，<code>A.c</code>上如果有索引的话，整个关联查询也不会使用。再看内层的查询，很明显<code>B.c</code>上如果有索引的话，能够加速查询，因此只需要在关联顺序中的第二张表的相应列上创建索引即可。</p>\n<h5>优化LIMIT分页</h5>\n<p>当需要分页操作时，通常会使用<code>LIMIT</code>加上偏移量的办法实现，同时加上合适的<code>ORDER BY</code>字句。如果有对应的索引，通常效率会不错，否则，MySQL需要做大量的文件排序操作。</p>\n<p>一个常见的问题是当偏移量非常大的时候，比如：<code>LIMIT 10000 20</code>这样的查询，MySQL需要查询10020条记录然后只返回20条记录，前面的10000条都将被抛弃，这样的代价非常高。</p>\n<p>优化这种查询一个最简单的办法就是尽可能的使用覆盖索引扫描，而不是查询所有的列。然后根据需要做一次关联查询再返回所有的列。对于偏移量很大时，这样做的效率会提升非常大。考虑下面的查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0caa3257606427\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT film_id,description FROM film ORDER BY title LIMIT 50,5;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0caa3257606427-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0caa3257606427-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0caa3257606427-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">film_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">description </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">film </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-e\">title </span><span class=\"crayon-i\">LIMIT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0caa3257606427-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>如果这张表非常大，那么这个查询最好改成下面的样子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0caa7024917077\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT film.film_id,film.description\r\nFROM film INNER JOIN (\r\n    SELECT film_id FROM film ORDER BY title LIMIT 50,5\r\n) AS tmp USING(film_id);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0caa7024917077-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0caa7024917077-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0caa7024917077-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0caa7024917077-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0caa7024917077-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0caa7024917077-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">film</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">film_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">film</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">description</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0caa7024917077-2\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">film </span><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0caa7024917077-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">film_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">film </span><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-e\">title </span><span class=\"crayon-i\">LIMIT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0caa7024917077-4\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tmp </span><span class=\"crayon-e\">USING</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">film_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0caa7024917077-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这里的延迟关联将大大提升查询效率，让MySQL扫描尽可能少的页面，获取需要访问的记录后在根据关联列回原表查询所需要的列。</p>\n<p>有时候如果可以使用书签记录上次取数据的位置，那么下次就可以直接从该书签记录的位置开始扫描，这样就可以避免使用<code>OFFSET</code>，比如下面的查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b1e56ab0caaa607493832\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT id FROM t LIMIT 10000, 10;\r\n改为：\r\nSELECT id FROM t WHERE id &gt; 10000 LIMIT 10;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0caaa607493832-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0caaa607493832-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b1e56ab0caaa607493832-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b1e56ab0caaa607493832-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b1e56ab0caaa607493832-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">id </span><span class=\"crayon-i\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">LIMIT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0caaa607493832-2\">改为：</div><div class=\"crayon-line\" id=\"crayon-5b1e56ab0caaa607493832-3\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">id </span><span class=\"crayon-i\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">LIMIT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b1e56ab0caaa607493832-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>其他优化的办法还包括使用预先计算的汇总表，或者关联到一个冗余表，冗余表中只包含主键列和需要做排序的列。</p>\n<h5>优化UNION</h5>\n<p>MySQL处理<code>UNION</code>的策略是先创建临时表，然后再把各个查询结果插入到临时表中，最后再来做查询。因此很多优化策略在<code>UNION</code>查询中都没有办法很好的时候。经常需要手动将<code>WHERE</code>、<code>LIMIT</code>、<code>ORDER BY</code>等字句“下推”到各个子查询中，以便优化器可以充分利用这些条件先优化。</p>\n<p>除非确实需要服务器去重，否则就一定要使用<code>UNION ALL</code>，如果没有<code>ALL</code>关键字，MySQL会给临时表加上<code>DISTINCT</code>选项，这会导致整个临时表的数据做唯一性检查，这样做的代价非常高。当然即使使用ALL关键字，MySQL总是将结果放入临时表，然后再读出，再返回给客户端。虽然很多时候没有这个必要，比如有时候可以直接把每个子查询的结果返回给客户端。</p>\n<h4>结语</h4>\n<p>理解查询是如何执行以及时间都消耗在哪些地方，再加上一些优化过程的知识，可以帮助大家更好的理解MySQL，理解常见优化技巧背后的原理。希望本文中的原理、示例能够帮助大家更好的将理论和实践联系起来，更多的将理论知识运用到实践中。</p>\n<p>其他也没啥说的了，给大家留两个思考题吧，可以在脑袋里想想答案，这也是大家经常挂在嘴边的，但很少有人会思考为什么？</p>\n<ol>\n<li>有非常多的程序员在分享时都会抛出这样一个观点：尽可能不要使用存储过程，存储过程非常不容易维护，也会增加使用成本，应该把业务逻辑放到客户端。既然客户端都能干这些事，那为什么还要存储过程？</li>\n<li><code>JOIN</code>本身也挺方便的，直接查询就好了，为什么还需要视图呢？</li>\n</ol>\n<h4>参考资料</h4>\n<p>[1] <a href=\"https://link.jianshu.com?t=http://union-click.jd.com/jdc?d=6vMwSD\" target=\"_blank\" rel=\"nofollow\">姜承尧 著；MySQL技术内幕-InnoDB存储引擎；机械工业出版社，2013</a><br>\n[2] <a href=\"https://link.jianshu.com?t=http://union-click.jd.com/jdc?d=wMESxy\" target=\"_blank\" rel=\"nofollow\">Baron Scbwartz 等著；宁海元 周振兴等译；高性能MySQL（第三版）; 电子工业出版社， 2013</a><br>\n[3] <a href=\"https://link.jianshu.com?t=https://segmentfault.com/a/1190000004690721\" target=\"_blank\" rel=\"nofollow\">由 B-/B+树看 MySQL索引结构</a></p>\n<blockquote><p>备注：水平有限，难免疏漏，如果问题请留言</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114041\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114041votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114041\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "tags": "IT技术,B+Tree,B-Tree,优化,索引", "front_image_url": ["http://wx4.sinaimg.cn/mw690/63918611gy1frnqlou40xj207p07dq32.jpg"], "url_object_id": "821f7f4efb272c0b6522e2a1e27276be", "front_image_path": "full/a63042e23025aa5a9fbe75d0a79efd00a9a8582f.jpg"}
